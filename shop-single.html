<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto | Hidden Brand</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Barra de navegación -->
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand fw-bold text-primary" href="index.html">Hidden Brand</a>

        <div class="collapse navbar-collapse" id="navbarToggler">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
                <li class="nav-item"><a class="nav-link active" href="productos.html">Productos</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Ofertas</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contacto</a></li>
            </ul>
            <a href="carrito.html" class="btn btn-outline-primary ms-3 position-relative">
                <i class="fas fa-shopping-cart"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                </span>
                <span class="visually-hidden">Productos en el carrito</span>
            </a>
        </div>
    </div>
</nav>
<!-- Fin de la barra de navegación -->

<main class="container mt-4">
    <div class="row" id="product-details">
        <!-- Los detalles del producto se cargarán aquí dinámicamente -->
    </div>
</main>

<!-- Script para cargar los detalles del producto -->
<script>
    // Lista de productos con sus detalles
    const products = {
        pantaloneta: {
            name: "Pantaloneta impermeable",
            description: "Pantaloneta de material resistente al agua, ideal para actividades al aire libre.",
            price: "$50.000",
            image: "https://irreal.vtexassets.com/arquivos/ids/239309-2000-3000?v=638468149445470000&width=2000&height=3000&aspect=true",
            tallas: ["S", "M", "L", "XL"],
            colores: ["Rojo", "Azul", "Negro", "Verde"]
        },
        camiseta: {
            name: "Camiseta Personalizada",
            description: "Diseño único para destacar tu estilo.",
            price: "$35.000",
            image: "https://i.etsystatic.com/35225642/r/il/e775f8/4190937694/il_1080xN.4190937694_jqlx.jpg",
            tallas: ["S", "M", "L"],
            colores: ["Blanco", "Negro", "Gris"]
        },
        jeans: {
            name: "Jeans Clásicos",
            description: "Comodidad y estilo para tu día a día.",
            price: "$80.000",
            image: "https://img.freepik.com/psd-gratis/vaqueros-azules-aislados-sobre-fondo-transparente_191095-17292.jpg?semt=ais_hybrid",
            tallas: ["30", "32", "34", "36"],
            colores: ["Azul", "Negro"]
        },
        gafas: {
            name: "Gafas de Sol",
            description: "Protección y estilo para cualquier ocasión.",
            price: "$45.000",
            image: "https://img.freepik.com/foto-gratis/gafas-sol-rectangulares-negro-sobre-fondo-blanco_151013-12903.jpg",
            tallas: ["Única"],
            colores: ["Negro", "Marrón"]
        }
    };

    // Función para obtener el producto de la URL
    function getProductFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("product");
    }

    // Función para actualizar el contador del carrito en la barra de navegación
    const CartManager = {
        getCart() {
            try {
                return JSON.parse(localStorage.getItem('cart')) || [];
            } catch (error) {
                console.error('Error al obtener el carrito:', error);
                return [];
            }
        },
    
        saveCart(cart) {
            try {
                localStorage.setItem('cart', JSON.stringify(cart));
                this.updateCartCount();
            } catch (error) {
                console.error('Error al guardar el carrito:', error);
            }
        },
    
        updateCartCount() {
            try {
                const cart = this.getCart();
                const totalCount = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
                const cartCountElement = document.getElementById('cartCount');
                if (cartCountElement) {
                    cartCountElement.textContent = totalCount > 0 ? totalCount : '';
                }
            } catch (error) {
                console.error('Error al actualizar el contador del carrito:', error);
            }
        },
    
        addToCart(product) {
            try {
                const cart = this.getCart();
                const existingItem = cart.find(item => item.id === product.id);
                
                if (existingItem) {
                    existingItem.quantity = (existingItem.quantity || 0) + 1;
                } else {
                    cart.push({
                        ...product,
                        quantity: 1
                    });
                }
                
                this.saveCart(cart);
            } catch (error) {
                console.error('Error al agregar al carrito:', error);
            }
        }
    };
    
    // Inicializar el contador del carrito cuando se carga la página
    document.addEventListener('DOMContentLoaded', () => {
        CartManager.updateCartCount();
    });
    
    // Actualizar el contador cuando se modifica el localStorage en otras pestañas
    window.addEventListener('storage', (e) => {
        if (e.key === 'cart') {
            CartManager.updateCartCount();
        }
    });

    // Función para mostrar el producto en el contenedor de detalles
    function displayProductDetails() {
        const productKey = getProductFromURL();
        const product = products[productKey];

        if (product) {
            const tallaOptions = product.tallas.map(talla => `<option value="${talla}">${talla}</option>`).join("");
            const colorOptions = product.colores.map(color => `<option value="${color}">${color}</option>`).join("");

            document.getElementById("product-details").innerHTML = `
                <div class="col-md-6">
                    <img src="${product.image}" class="img-fluid" alt="${product.name}">
                </div>
                <div class="col-md-6">
                    <h2>${product.name}</h2>
                    <p>${product.description}</p>
                    <p><strong>Precio:</strong> ${product.price}</p>

                    <!-- Opciones de color -->
                    <div class="mb-3">
                        <label for="colorSelect" class="form-label">Color:</label>
                        <select id="colorSelect" class="form-select">
                            ${colorOptions}
                        </select>
                    </div>

                    <!-- Opciones de talla -->
                    <div class="mb-3">
                        <label for="tallaSelect" class="form-label">Talla:</label>
                        <select id="tallaSelect" class="form-select">
                            ${tallaOptions}
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="addToCart('${productKey}')">Agregar al carrito</button>
                </div>
            `;
        } else {
            document.getElementById("product-details").innerHTML = "<p>Producto no encontrado.</p>";
        }
    }

    // Función para agregar el producto al carrito
    function addToCart(productKey) {
        const color = document.getElementById("colorSelect").value;
        const talla = document.getElementById("tallaSelect").value;
    
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const product = products[productKey];
        const price = parseFloat(product.price.replace("$", "").replace(".", ""));
        const existingProductIndex = cart.findIndex(item => item.name === product.name && item.color === color && item.talla === talla);
    
        if (existingProductIndex !== -1) {
            cart[existingProductIndex].quantity += 1;
        } else {
            cart.push({ ...product, price: price, quantity: 1, color: color, talla: talla });
        }
    
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartCount();  // Actualiza el contador
        alert("Producto agregado al carrito!");
    }    

    // Inicializar la visualización del producto al cargar la página
    document.addEventListener("DOMContentLoaded", displayProductDetails);
</script>

</body>
</html>
